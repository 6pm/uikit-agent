# üîß –ö–µ—Ä—ñ–≤–Ω–∏—Ü—Ç–≤–æ –ø–æ Redis –¥–ª—è –¥–µ–±–∞–≥—É Huey

https://www.youtube.com/watch?v=jgpVdJB2sKQ&t=433s

## –©–æ —Ç–∞–∫–µ Redis?

Redis (Remote Dictionary Server) - —Ü–µ —à–≤–∏–¥–∫–∞ –±–∞–∑–∞ –¥–∞–Ω–∏—Ö –≤ –ø–∞–º'—è—Ç—ñ, —è–∫–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è —è–∫:
- **–ß–µ—Ä–≥–∞ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å** (message queue) - –¥–ª—è Huey
- **–ö–µ—à** - –¥–ª—è –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤
- **Pub/Sub** - –¥–ª—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å –º—ñ–∂ –ø—Ä–æ—Ü–µ—Å–∞–º–∏

## –Ø–∫ Huey –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î Redis?

Huey –∑–±–µ—Ä—ñ–≥–∞—î –≤ Redis:
1. **–ß–µ—Ä–≥–∏ —Ç–∞—Å–æ–∫** (`huey.main.myapp`) - —Ç–∞—Å–∫–∏, —è–∫—ñ –æ—á—ñ–∫—É—é—Ç—å –≤–∏–∫–æ–Ω–∞–Ω–Ω—è
2. **–†–µ–∑—É–ª—å—Ç–∞—Ç–∏** (`huey.results.myapp`) - —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏ –≤–∏–∫–æ–Ω–∞–Ω–∏—Ö —Ç–∞—Å–æ–∫
3. **–†–æ–∑–∫–ª–∞–¥** (`huey.schedule.myapp`) - —Ç–∞—Å–∫–∏, –∑–∞–ø–ª–∞–Ω–æ–≤–∞–Ω—ñ –Ω–∞ –º–∞–π–±—É—Ç–Ω—î
4. **–ë–ª–æ–∫—É–≤–∞–Ω–Ω—è** (`huey.lock.myapp:*`) - –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó

**–ü—Ä–∏–º—ñ—Ç–∫–∞**: Huey –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î —Ñ–æ—Ä–º–∞—Ç –∑ –∫—Ä–∞–ø–∫–∞–º–∏ (`.`). –ù–∞–∑–≤–∞ –¥–æ–¥–∞—Ç–∫—É (`myapp`) –±–µ—Ä–µ—Ç—å—Å—è –∑ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó `RedisHuey('my_app', ...)` –≤ `config.py`.

## üìã –û—Å–Ω–æ–≤–Ω—ñ –∫–æ–º–∞–Ω–¥–∏ Redis CLI

### –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ Redis

```bash
# –ß–µ—Ä–µ–∑ Docker
docker exec -it uikit-agent-redis-1 redis-cli
```

### –ë–∞–∑–æ–≤—ñ –∫–æ–º–∞–Ω–¥–∏

```bash
# –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è
PING
# –í—ñ–¥–ø–æ–≤—ñ–¥—å: PONG

# –ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –≤—Å—ñ –∫–ª—é—á—ñ
KEYS *


# –ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –∫–ª—é—á—ñ Huey
KEYS huey.*

# –ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ —Ç–∏–ø –∫–ª—é—á–∞
TYPE huey.results.myapp

# –ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ TTL (—á–∞—Å –∂–∏—Ç—Ç—è) –∫–ª—é—á–∞
TTL huey.results.myapp

# –û—Ç—Ä–∏–º–∞—Ç–∏ –∑–Ω–∞—á–µ–Ω–Ω—è –∫–ª—é—á–∞ (—Ä–µ–∑—É–ª—å—Ç–∞—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ—ó —Ç–∞—Å–∫–∏)
GET huey.results.myapp

# –ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –¥–æ–≤–∂–∏–Ω—É —Å–ø–∏—Å–∫—É (—á–µ—Ä–≥–∏)
LLEN huey.main.myapp

# –ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –µ–ª–µ–º–µ–Ω—Ç–∏ —á–µ—Ä–≥–∏
LRANGE huey.main.myapp 0 -1

# –ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –ø–µ—Ä—à—ñ 5 –µ–ª–µ–º–µ–Ω—Ç—ñ–≤
LRANGE huey.main.myapp 0 4

# –û—á–∏—Å—Ç–∏—Ç–∏ –≤—Å—ñ –¥–∞–Ω—ñ (‚ö†Ô∏è –Ω–µ–±–µ–∑–ø–µ—á–Ω–æ!)
FLUSHALL

# –û—á–∏—Å—Ç–∏—Ç–∏ —Ç—ñ–ª—å–∫–∏ –ø–æ—Ç–æ—á–Ω—É –±–∞–∑—É
FLUSHDB

# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ Redis
INFO

# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–∞–º'—è—Ç—ñ
INFO memory

# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–æ–º–∞–Ω–¥
INFO stats
```

## üîç –î—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ Huey —á–µ—Ä–µ–∑ Redis

### 1. –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏, —á–∏ —î —Ç–∞—Å–∫–∏ –≤ —á–µ—Ä–∑—ñ

```bash
# –ü—ñ–¥–∫–ª—é—á–∏—Ç–∏—Å—è –¥–æ Redis
docker exec -it uikit-agent-redis-1 redis-cli

# –ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –≤—Å—ñ —á–µ—Ä–≥–∏
KEYS huey.main.*

# –ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –∫—ñ–ª—å–∫—ñ—Å—Ç—å —Ç–∞—Å–æ–∫ –≤ —á–µ—Ä–∑—ñ
LLEN huey.main.myapp

# –ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ —Ç–∞—Å–∫–∏ –≤ —á–µ—Ä–∑—ñ
LRANGE huey.main.myapp 0 -1
```

### 2. –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏ —Ç–∞—Å–æ–∫

```bash
# –ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –≤—Å—ñ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏
KEYS huey.results.*

# –ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç (huey.results.myapp - —Ü–µ hash –∑ —É—Å—ñ–º–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏)
HGETALL huey.results.my_app
```

### 3. –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ –≤ —Ä–µ–∞–ª—å–Ω–æ–º—É —á–∞—Å—ñ

```bash
# –ú–æ–Ω—ñ—Ç–æ—Ä–∏—Ç–∏ –≤—Å—ñ –∫–æ–º–∞–Ω–¥–∏ Redis
docker exec -it uikit-agent-redis-1 redis-cli MONITOR

# –ú–æ–Ω—ñ—Ç–æ—Ä–∏—Ç–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ñ –∫–ª—é—á—ñ (–ø–æ—Ç—Ä—ñ–±–µ–Ω Redis 6.2+)
# –¶–µ –ø–æ–∫–∞–∑—É—î –≤—Å—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó –∑ –∫–ª—é—á–∞–º–∏ Huey
```

## üõ†Ô∏è –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è Python —Å–∫—Ä–∏–ø—Ç–∞ –¥–ª—è –¥–µ–±–∞–≥—É

–ú–∏ —Å—Ç–≤–æ—Ä–∏–ª–∏ –∑—Ä—É—á–Ω–∏–π —Å–∫—Ä–∏–ø—Ç `utils/redis_debug.py`:

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç–∏ —Å–∫—Ä–∏–ø—Ç
python utils/redis_debug.py

# –ê–±–æ –∑ –≤—ñ—Ä—Ç—É–∞–ª—å–Ω–∏–º —Å–µ—Ä–µ–¥–æ–≤–∏—â–µ–º
source .venv/bin/activate
python utils/redis_debug.py
```

–°–∫—Ä–∏–ø—Ç –Ω–∞–¥–∞—î —ñ–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–µ –º–µ–Ω—é:
1. –ü–æ–∫–∞–∑–∞—Ç–∏ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ —á–µ—Ä–≥–∏
2. –ü–æ–∫–∞–∑–∞—Ç–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É Redis
3. –ü–æ–∫–∞–∑–∞—Ç–∏ –≤—Å—ñ –∫–ª—é—á—ñ Huey
4. –ü–æ–∫–∞–∑–∞—Ç–∏ –¥–µ—Ç–∞–ª—ñ –∫–ª—é—á–∞
5. –ú–æ–Ω—ñ—Ç–æ—Ä–∏—Ç–∏ —Ç–∞—Å–∫–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º—É —á–∞—Å—ñ
6. –û—á–∏—Å—Ç–∏—Ç–∏ –≤—Å—ñ –¥–∞–Ω—ñ Huey

## üìä –¢–∏–ø–æ–≤—ñ —Å—Ü–µ–Ω–∞—Ä—ñ—ó –¥–µ–±–∞–≥—É

### –°—Ü–µ–Ω–∞—Ä—ñ–π 1: –¢–∞—Å–∫–∞ –Ω–µ –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è

```bash
# 1. –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏, —á–∏ —î —Ç–∞—Å–∫–∞ –≤ —á–µ—Ä–∑—ñ
docker exec -it uikit-agent-redis-1 redis-cli LLEN huey.main.myapp

# 2. –Ø–∫—â–æ —î —Ç–∞—Å–∫–∏, –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏, —á–∏ –ø—Ä–∞—Ü—é—î Huey worker
# –ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –ª–æ–≥–∏ Huey worker

# 3. –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ Redis
docker exec -it uikit-agent-redis-1 redis-cli PING
```


### –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏, —á–∏ —î —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
```bash
# –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏, —á–∏ —î —Ä–µ–∑—É–ª—å—Ç–∞—Ç
docker exec uikit-agent-redis-1 redis-cli KEYS huey.results.*

# –ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –≤—Å—ñ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏ (huey.results.myapp - —Ü–µ hash)
docker exec uikit-agent-redis-1 redis-cli HGETALL huey.results.myapp

# –ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∑–∞ task_id
docker exec uikit-agent-redis-1 redis-cli HGET huey.results.myapp task-id
```


### –°—Ü–µ–Ω–∞—Ä—ñ–π 3: –ë–∞–≥–∞—Ç–æ —Ç–∞—Å–æ–∫ –≤ —á–µ—Ä–∑—ñ (–∑–∞—Å—Ç—ñ–π)

```bash
# –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –∫—ñ–ª—å–∫—ñ—Å—Ç—å —Ç–∞—Å–æ–∫
docker exec -it uikit-agent-redis-1 redis-cli LLEN huey.main.myapp

# –Ø–∫—â–æ –±–∞–≥–∞—Ç–æ, –º–æ–∂–ª–∏–≤–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ –∑–±—ñ–ª—å—à–∏—Ç–∏ –∫—ñ–ª—å–∫—ñ—Å—Ç—å workers
# –ê–±–æ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏, —á–∏ –Ω–µ –∑–∞–≤–∏—Å–∞—é—Ç—å —Ç–∞—Å–∫–∏
```

## üîê –ë–µ–∑–ø–µ–∫–∞ —Ç–∞ –æ–±–µ—Ä–µ–∂–Ω—ñ—Å—Ç—å

‚ö†Ô∏è **–£–í–ê–ì–ê**: –î–µ—è–∫—ñ –∫–æ–º–∞–Ω–¥–∏ –º–æ–∂—É—Ç—å –≤–∏–¥–∞–ª–∏—Ç–∏ –¥–∞–Ω—ñ!

- `FLUSHALL` - –≤–∏–¥–∞–ª—è—î –í–°–Ü –¥–∞–Ω—ñ –∑ Redis
- `FLUSHDB` - –≤–∏–¥–∞–ª—è—î –≤—Å—ñ –¥–∞–Ω—ñ –∑ –ø–æ—Ç–æ—á–Ω–æ—ó –±–∞–∑–∏
- `DEL key` - –≤–∏–¥–∞–ª—è—î –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏–π –∫–ª—é—á

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—è**: –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ `redis_debug.py` –¥–ª—è –±–µ–∑–ø–µ—á–Ω–æ–≥–æ –ø–µ—Ä–µ–≥–ª—è–¥—É —Ç–∞ –æ—á–∏—â–µ–Ω–Ω—è.

## üìö –ö–æ—Ä–∏—Å–Ω—ñ –ø–æ—Å–∏–ª–∞–Ω–Ω—è

- [Redis Documentation](https://redis.io/docs/)
- [Redis CLI Commands](https://redis.io/commands/)
- [Huey Documentation](https://huey.readthedocs.io/)

## üí° –ü–æ—Ä–∞–¥–∏

1. **–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ `redis_debug.py`** –¥–ª—è –∑—Ä—É—á–Ω–æ–≥–æ –ø–µ—Ä–µ–≥–ª—è–¥—É –¥–∞–Ω–∏—Ö
2. **–ú–æ–Ω—ñ—Ç–æ—Ä—Ç–µ Redis** –ø—ñ–¥ —á–∞—Å —Ä–æ–∑—Ä–æ–±–∫–∏, —â–æ–± —Ä–æ–∑—É–º—ñ—Ç–∏, —â–æ –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è
3. **–ù–µ –≤–∏–¥–∞–ª—è–π—Ç–µ –¥–∞–Ω—ñ** –±–µ–∑ –Ω–µ–æ–±—Ö—ñ–¥–Ω–æ—Å—Ç—ñ - —Ü–µ –º–æ–∂–µ –ø–æ—Ä—É—à–∏—Ç–∏ —Ä–æ–±–æ—Ç—É Huey
4. **–ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ TTL** –∫–ª—é—á—ñ–≤ - –¥–µ—è–∫—ñ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏ –º–æ–∂—É—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤–∏–¥–∞–ª—è—Ç–∏—Å—è
5. **–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ `MONITOR`** –¥–ª—è –¥—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –ø—Ä–æ–±–ª–µ–º –∑ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è–º
