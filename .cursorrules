# UIKit Agent - Cursor Rules

## Package Manager
- **ALWAYS use `uv` as the package manager** for this project
- Use `uv pip install <package>` to install packages
- Use `uv pip install -r requirements.txt` to install dependencies
- Use `uv venv` to create virtual environments
- When adding new dependencies, update `requirements.txt` and use `uv pip install <package>` to install
- Never use `pip`, `pip3`, `poetry`, or other package managers


## Technology Stack
- **FastAPI** - REST API framework
- **Huey + Redis** - Background task queue
- **LangGraph** - Multi-stage AI agent workflows
- **LangChain** - LLM integration (OpenAI/Anthropic)
- **Pydantic** - Data validation and type safety

## Code Style & Best Practices

### Python
- Use type hints for all function parameters and return types
- Follow PEP 8 style guidelines
- Use `TypedDict` for state objects in LangGraph agents
- Use descriptive variable names and docstrings

### FastAPI
- Use Pydantic models for request/response validation
- Convert Pydantic models to dicts before passing to Huey tasks (Huey can't serialize Pydantic models directly)
- Return task IDs immediately for async operations
- Use proper HTTP status codes and error handling

### LangGraph
- Use `StateGraph` for multi-stage workflows
- Define clear state schemas using `TypedDict`
- Keep nodes focused on single responsibilities
- Use proper error handling and state management

### Huey Tasks
- Keep tasks idempotent when possible
- Use proper logging for task execution
- Handle errors gracefully and log them
- Convert complex objects to dicts before queuing

### Logging
- Use the `logging` module with proper log levels
- Include context in log messages (task IDs, component names, etc.)
- Use structured logging format: `%(asctime)s - %(name)s - %(levelname)s - %(message)s`


## Dependencies
- When adding new dependencies, always use `uv pip install <package>`
- Update `requirements.txt` with exact versions when possible
- Test that new dependencies work with the existing stack

## Error Handling
- Use try-except blocks with specific exception types
- Log errors with full context using `exc_info=True`
- Return meaningful error messages to API clients
- Handle Redis/Huey connection errors gracefully

## Documentation
- Add docstrings to all classes and functions
- Update README.md when adding new features or changing setup
- Keep code comments focused on "why" not "what"
